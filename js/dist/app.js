function inner(show){void 0===show&&(show="all"),"all"==show?$(".inner_element").removeClass("no-show"):"bar"==show?($(".inner_element").addClass("no-show"),$(".bar_t").removeClass("no-show")):$(".inner_element").addClass("no-show")}angular.module("compraPizzas",["ngRoute","ngCookies"]),angular.module("compraPizzas").config(function($routeProvider){$routeProvider.when("/",{templateUrl:BASE_URL+"user/home"}),$routeProvider.when("/cadastro",{templateUrl:BASE_URL+"user/cadastro"}),$routeProvider.when("/compra",{templateUrl:BASE_URL+"user/compra"}),$routeProvider.when("/pedidos",{templateUrl:BASE_URL+"user/pedidos"}),$routeProvider.when("/user",{templateUrl:BASE_URL+"user/dados"})}),angular.module("compraPizzas").directive("onlyNum",function(){return function(scope,element,attrs){var keyCode=[8,9,37,39,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,110];element.bind("keydown",function(event){console.log($.inArray(event.which,keyCode)),-1==$.inArray(event.which,keyCode)&&(scope.$apply(function(){scope.$eval(attrs.onlyNum),event.preventDefault()}),event.preventDefault())})}}),angular.module("compraPizzas").factory("sharedMessages",function(){var message={};return{getData:function(){return message},setData:function(newMessage){message=newMessage},resetData:function(){message={}}}}),angular.module("compraPizzas").controller("inicialCtrl",function($scope,$http,$location,$cookies,sharedMessages,$route,$templateCache){inner(!1),$scope.isActive=function(path){return!(!$route.current||!$route.current.regexp)&&$route.current.regexp.test(path)},$scope.loginDisabled=!1,$scope.loginOk="",$scope.erroLogin="",$scope.login={};var msg=sharedMessages.getData();$scope.mensagemCadastro=msg.cadastro_ok,sharedMessages.resetData(),$scope.doLogin=function(){$scope.loginOk="",$scope.erroLogin="",$scope.loginDisabled=!0,$http({method:"POST",url:BASE_URL+"ajax/login",data:$scope.login,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.errorNome=data.errorNome,$scope.errorEmail=data.errorEmail,"1"==data?($scope.loginOk="1",$http.get(BASE_URL+"user/confirma_email/ok").success(function($data){var currentPageTemplate=$route.current.templateUrl;$templateCache.remove(currentPageTemplate),$route.reload()})):($scope.erroLogin="Erro ao fazer login. Verifique usuÃ¡rio e senha e tente novamente.",$scope.loginDisabled=!1),_log(data)})},$scope.solicitaAlteracaoSenha=function(){_log("Solicitando alteraÃ§Ã£o de senha para: "+$scope.esqueci),$scope.isDisabled=!0,$http({method:"POST",url:BASE_URL+"ajax/geraTokenAltSenha",data:{dados:$scope.esqueci},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.isDisabled=!1,"ok"==data?(toastr.info("Enviamos um e-mail para vocÃª com instruÃ§Ãµes para alterar a sua senha."),$("#modalEsqueciASenha").modal("hide")):(toastr.error("E-mail nÃ£o existe em nosso cadastro"),$scope.esqueci="")})}}),angular.module("compraPizzas").controller("cadastroCtrl",function($scope,$http,$location,sharedMessages){inner(!1),$scope.isDisabled=!1,$scope.cidades=[],$http.get(BASE_URL+"ajax/get_cidades").success(function($data){$scope.cidades=$data}),$scope.cadastro={},$scope.submitForm=function(){$scope.isDisabled=!0,$scope.errorNome="",$http({method:"POST",url:BASE_URL+"ajax/cadastraUser",data:$scope.cadastro,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){if($scope.errorNome=data.errorNome,$scope.errorEmail=data.errorEmail,$scope.errorSenha=data.errorSenha,$scope.errorFone=data.errorFone,$scope.errorCPF=data.errorCPF,$scope.errorRua=data.errorRua,$scope.errorBairro=data.errorBairro,$scope.errorCidade=data.errorCidade,$scope.errorNumero=data.errorNumero,$scope.errorCEP=data.errorCEP,$scope.errorForm="",$scope.removendoItemListaPedido=!1,"ok"==data){sharedMessages.setData({cadastro_ok:"Cadastro efetuado com sucesso, faÃ§a login abaixo."}),$location.path("/")}else $scope.errorForm="Corrija os erros e tente novamente",$scope.isDisabled=!1;_log(data)})}}),angular.module("compraPizzas").controller("compraCtrl",function($scope,$http,$location,sharedMessages){inner(),$(".modal").modal("hide"),_log("habilitando compra"),$scope.inicializa=function(){$scope.id_sabor="",$scope.qnt_field=1,$scope.qnt_field_calzone=1,$scope.valor_pizza="",$scope.valor_pizza_base="",$scope.current_item_calzone="",$scope.current_item_pizza="",$scope.qnt_sabores="",$scope.adicionandoAoPedido=!1,$scope.carregandoItemEdicao=!1,$scope.regedit="",$scope.emEdicao="",$scope.id_edicao="",$scope.bebida_select="",$scope.bebidas_quantidade=1,$scope.total_bebida="",$scope.finalizando=!1,$scope.entregar=!1,$scope.retirar=!1,$scope.dados_entrega={},$scope.trocopara=!1,$scope.mensagemSucessoPedido=!1,$scope.item_edt={quantidade:1},$scope.calzone={tamanhoCalzone:""},$scope.pizza={tamanho:""}},$http.get(BASE_URL+"pedidos/get_pizza_tamanhos").success(function($data){$scope.tamanhos=$data}),$http.get(BASE_URL+"pedidos/get_calzone_tamanhos").success(function($data){$scope.tamanhosCalzone=$data}),$http.get(BASE_URL+"pedidos/get_pizza_categorias").success(function($data){$scope.categorias=$data}),$http.get(BASE_URL+"pedidos/get_calzone_categorias").success(function($data){$scope.categoriasCalzone=$data}),$http.get(BASE_URL+"pedidos/get_pizza_sabores_por_categorias").success(function($data){$scope.lista_sabores=$data}),$http.get(BASE_URL+"pedidos/get_calzone_sabores_por_categorias").success(function($data){$scope.lista_sabores_calzone=$data}),$http.get(BASE_URL+"pedidos/get_bebidas").success(function($data){$scope.lista_bebidas=$data}),$http.get(BASE_URL+"pedidos/get_cadastro").success(function($data){$scope.meus_dados=$data}),$http.get(BASE_URL+"ajax/get_pizzaria_dados").success(function($data){$scope.pizzaria_dados=$data}),selecionaMenu("compra"),carregandoPedido(),$scope.seleciona_bebida=function(){_log("Seleciona bebida"+$scope.bebida_select),$scope.calculaTotalBebida()},$scope.calculaTotalBebida=function(){_log("calculando total bebida "+$scope.bebidas_quantidade),null!=$scope.bebidas_quantidade&&""!=$scope.bebidas_quantidade||($scope.bebidas_quantidade=1),""!=$scope.bebida_select?$scope.total_bebida=$scope.bebida_select.valor*$scope.bebidas_quantidade:$scope.total_bebida=""},$scope.addBebida=function(){$scope.adicionandoAoPedido=!0,$http({method:"POST",url:BASE_URL+"pedidos/addBebidaToPedidoTemp",data:{item:$scope.bebida_select,quantidade:$scope.bebidas_quantidade},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.atualizaPedido(),$(".modalCalzone").modal("hide"),$scope.adicionandoAoPedido=!1,toastr.info("Item adicionado com sucesso."),$scope.bebida_select="",$scope.bebidas_quantidade="",$scope.total_bebida="",$(".modalBebida").modal("hide")}).error(function(){$scope.adicionandoAoPedido=!1,toastr.error("erro ao processar carregamento do item no pedido")})},$scope.atualizaPedido=function(){$scope.itens_pedido="",$http({method:"POST",url:BASE_URL+"pedidos/get_tmp",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){if(pedido_proc=JSON.parse(data[0].pedido),0==pedido_proc.length)_log("Nenhum item add"),carregandoPedido(!1),$(".pedidosWelcome").show(200);else{$scope.itens_pedido=pedido_proc.itens,valTot=0;for(var i=0;i<$scope.itens_pedido.length;i++)valTot+=$scope.itens_pedido[i].quantidade*$scope.itens_pedido[i].valor;$scope.total_pedido=valTot,_log($scope.itens_pedido),$(".pedidosWelcome").hide(300),carregandoPedido(!1)}}).error(function(){_log("erro ao processar carregamento do pedido"),carregandoPedido(!1)})},$scope.atualizaItemPizza=function(){$scope.current_item_calzone="",$(".lista_sabores").append('<div class="lddtit"><center><img src="'+BASE_URL+'images/loading.gif"></center></div>'),$http.get(BASE_URL+"pedidos/get_current_item").success(function($data){$scope.current_item_pizza=$data,_log("current Pizza : "+$scope.current_item_pizza),$(".lddtit").remove()})},$scope.atualizaItemCalzone=function(){$scope.current_item_pizza="",$(".lista_sabores").append('<div class="lddtit"><center><img src="'+BASE_URL+'images/loading.gif"></center></div>'),$http.get(BASE_URL+"pedidos/get_current_item").success(function($data){$scope.current_item_calzone=$data,_log("current calzone : "+$scope.current_item_calzone),$(".lddtit").remove()})},$scope.removerSabor=function(id_remove){_log("Removendo sabor : "+id_remove),$http({method:"POST",url:BASE_URL+"pedidos/remove_itens_sabores",data:{id_remove:id_remove},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){_log("ret rem item dbg : "+data),"ok"==data?toastr.success("Sabor removido com sucesso"):toastr.error("Erro ao remover sabor"),""!=$scope.current_item_calzone?(_log("Remover sabor atualizando calzone"),$scope.atualizaItemCalzone()):""!=$scope.current_item_calzone&&(_log("Remover sabor atualizando pizza"),$scope.atualizaItemPizza())}).error(function(){$scope.atualizaItem(),toastr.error("Erro ao remover sabor")})},$scope.selecionaSabor=function(id_sab){_log("Sabor selecionado : "+id_sab),$scope.id_sabor==id_sab?($(".sabor"+id_sab).removeClass("sabor-lista-selecionado"),$scope.id_sabor=""):($scope.id_sabor=id_sab,$(".item_sabor").removeClass("sabor-lista-selecionado"),$(".sabor"+id_sab).addClass("sabor-lista-selecionado"))},$scope.ProcessaAddSabor=function(){""!=$scope.id_sabor&&($scope.unable_add_sabor=!0,_log("Adicionando sabor...:"+$scope.id_sabor),$http({method:"POST",url:BASE_URL+"pedidos/registra_item_sabores",data:{id_sabor:$scope.id_sabor},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.id_sabor="","MAXIMO"==data?($scope.atualizaItemPizza(),returnToaddPizzaModalForm(),$scope.id_sabor="",toastr.error("VocÃª jÃ¡ adicionou o nÃºmero mÃ¡ximo de sabores para o tipo de pizza"),carregandoPedido(!1)):($scope.atualizaItemPizza(),returnToaddPizzaModalForm(),$scope.id_sabor="",toastr.success("Sabor adicionado com sucesso!"),carregandoPedido(!1)),$scope.unable_add_sabor=!1,$(".sabor-lista-selecionado").removeClass("sabor-lista-selecionado"),$(".busca_sabores_in").val("")}).error(function(){$scope.atualizaItemPizza(),$(".sabor-lista-selecionado").removeClass("sabor-lista-selecionado"),$(".busca_sabores_in").val(""),returnToaddPizzaModalForm(),$scope.id_sabor="",toastr.error("erro ao adicionar sabor"),$scope.unable_add_sabor=!1}))},$scope.ProcessaAddSaborCalzone=function(){""!=$scope.id_sabor&&($scope.unable_add_sabor_calzone=!0,_log("Adicionando sabor...:"+$scope.id_sabor),$http({method:"POST",url:BASE_URL+"pedidos/registra_item_sabores",data:{id_sabor:$scope.id_sabor},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.id_sabor="","MAXIMO"==data?($scope.atualizaItemCalzone(),returnToaddCalzoneModalForm(),$scope.id_sabor="",toastr.error("VocÃª jÃ¡ adicionou o nÃºmero mÃ¡ximo de sabores para o tipo de pizza"),carregandoPedido(!1)):($scope.atualizaItemCalzone(),returnToaddCalzoneModalForm(),$scope.id_sabor="",toastr.success("Sabor adicionado com sucesso!"),carregandoPedido(!1)),$scope.unable_add_sabor_calzone=!1,$(".sabor-lista-selecionado").removeClass("sabor-lista-selecionado"),$(".busca_sabores_in").val("")}).error(function(){$scope.atualizaItemCalzone(),$(".sabor-lista-selecionado").removeClass("sabor-lista-selecionado"),$(".busca_sabores_in").val(""),returnToaddCalzoneModalForm(),$scope.id_sabor="",toastr.error("erro ao adicionar sabor"),$scope.unable_add_sabor_calzone=!1}))},$scope.calculaTotal=function(){_log($scope.qnt_field),null!=$scope.qnt_field&&""!=$scope.qnt_field||($scope.qnt_field=1);var valor=$scope.valor_pizza_base,quant=$scope.qnt_field;$scope.valor_pizza=valor*quant,$http.get(BASE_URL+"pedidos/updatePrecoTmp/"+$scope.qnt_field)},$scope.calculaTotalCalzone=function(){_log($scope.qnt_field_calzone),null!=$scope.qnt_field_calzone&&""!=$scope.qnt_field_calzone||($scope.qnt_field_calzone=1);var valor=$scope.valor_calzone_base,quant=$scope.qnt_field_calzone;$scope.valor_calzone=valor*quant,$http.get(BASE_URL+"pedidos/updatePrecoTmp/"+$scope.qnt_field_calzone)},$scope.addCalzone=function(){_log("Adicionando Calzone"),0!=$(".box_lista_sabores_item_calzone").size()?($scope.adicionandoAoPedido=!0,$http({method:"POST",url:BASE_URL+"pedidos/addItemToPedidoTemp",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.atualizaPedido(),$(".modalCalzone").modal("hide"),$scope.adicionandoAoPedido=!1,toastr.info("Item adicionado com sucesso."),$scope.zeraItens(),$scope.valor_calzone="",$scope.valor_pizza=""}).error(function(){$scope.adicionandoAoPedido=!1,_log("erro ao processar carregamento do item no pedido")})):toastr.error("Adicione ao menos um sabor")},$scope.addPizza=function(){_log("Adicionando Pizza"),0!=$(".box_lista_sabores_item").size()?($scope.adicionandoAoPedido=!0,$http({method:"POST",url:BASE_URL+"pedidos/addItemToPedidoTemp",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.atualizaPedido(),$(".modalPizza").modal("hide"),$scope.adicionandoAoPedido=!1,toastr.info("Item adicionado com sucesso."),$scope.zeraItens(),$scope.valor_calzone="",$scope.valor_pizza=""}).error(function(){$scope.adicionandoAoPedido=!1,_log("erro ao processar carregamento do item no pedido")})):toastr.error("Adicione ao menos um sabor")},$scope.zeraItens=function(tipo){void 0===tipo&&(tipo="TODOS"),_log("Zerando itens...:"+tipo),"pizza"==tipo||"TODOS"==tipo?($scope.pizza={tamanho:""},$scope.qnt_field=1,$scope.valor_pizza_base="",$scope.valor_pizza=""):"calzone"!=tipo&&"TODOS"!=tipo||($scope.calzone={tamanhoCalzone:""},$scope.qnt_field_calzone=1,$scope.valor_calzone_base="",$scope.valor_calzone="")},$scope.addSaborPizza=function(){$(".addPizzaModalForm").hide(200),$(".saborPizzaSelect").show(200),_log("novo sabor")},$scope.addSaborCalzone=function(){$(".addCalzoneModalForm").hide(200),$(".saborCalzoneSelect").show(200),_log("novo sabor de calzone")},$scope.atualizaOpcoesCalzone=function(){_log("aplicando tamanho do calzone"),$scope.zeraItens("pizza"),$("#detalhesCalzone").append('<div class="item_load"><center><img src="'+BASE_URL+'images/loading.gif"></center></div>'),""!=$scope.calzone.tamanhoCalzone?$http({method:"POST",url:BASE_URL+"pedidos/registra_item",data:{tamanho:$scope.calzone.tamanhoCalzone,tipo:"calzone"},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$(".item_load").remove(),0==data.length?(_log("erro ao processar item"),toastr.error("Erro ao processar item"),$(".modalCalzone").modal("hide")):(_log(data),$scope.valor_calzone=data.valor,$scope.valor_calzone_base=data.valor,$scope.qnt_sabores=data.num_sabores,$scope.atualizaItemCalzone(),$scope.calculaTotal())}).error(function(){$(".item_load").remove(),_log("erro ao processar carregamento do pedido"),carregandoPedido(!1)}):($scope.valor_calzone="",$scope.valor_calzone_base=0)},$scope.atualizaOpcoesPizza=function(){_log("aplicando tamanho da pizza"),$scope.zeraItens("calzone"),$scope.qnt_sabores="",$("#detalhesPizza").append('<div class="item_load"><center><img src="'+BASE_URL+'images/loading.gif"></center></div>'),""!=$scope.pizza.tamanho?$http({method:"POST",url:BASE_URL+"pedidos/registra_item",data:{tamanho:$scope.pizza.tamanho,tipo:"pizza"},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$(".item_load").remove(),0==data.length?(_log("erro ao processar item"),toastr.error("Erro ao processar item"),$(".modalPizza").modal("hide")):(_log(data),$scope.valor_pizza=data.valor,$scope.valor_pizza_base=data.valor,$scope.qnt_sabores=data.num_sabores,confPizza(),$scope.atualizaItemPizza(),$scope.calculaTotal())}).error(function(){$(".item_load").remove(),_log("erro ao processar carregamento do pedido"),carregandoPedido(!1)}):($scope.valor_pizza="",$scope.valor_pizza_base=0)},$scope.liberaCadastroNovoSabor=function(){return $n_sab=$(".box_lista_sabores_item").size(),!($n_sab<$scope.qnt_sabores)},$scope.liberaCadastroNovoSaborCalzone=function(){return $n_sab=$(".box_lista_sabores_item_calzone").size(),!($n_sab<$scope.qnt_sabores)},$scope.removeItemListaPedido=function(id_remove){$scope.removendoItemListaPedido?toastr.error("Aguarde a remoÃ§Ã£o do item atual"):(_log("removendo item : "+id_remove),$scope.removendoItemListaPedido=!0,$http.get(BASE_URL+"pedidos/remove_item_lista_pedido_tmp/"+id_remove).success(function($data){$scope.removendoItemListaPedido=!1,toastr.success("Item removido com sucesso"),$scope.atualizaPedido()}))},$scope.editaItemListaPedido=function(id_edita){_log("Editando item "+id_edita+" quantidade : "+$scope.item_edt.quantidade),$scope.emEdicao="ok",$scope.id_edicao=id_edita,$(".kc_fab_wrapper").hide(100),$scope.item_edt={quantidade:parseInt($scope.itens_pedido[id_edita].quantidade)}},$scope.concluirEdicao=function(){_log("edicao ok"),$http({method:"POST",url:BASE_URL+"pedidos/atualiza_quantidade_item",data:{quantidade:$scope.item_edt.quantidade,linha:$scope.id_edicao},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.emEdicao="",$scope.id_edicao="",$(".kc_fab_wrapper").show(500),toastr.success("Registro editado com sucesso"),$scope.atualizaPedido(),$scope.item_edt.quantidade=1}).error(function(){$scope.emEdicao="",$scope.id_edicao="",$(".kc_fab_wrapper").show(500),toastr.error("erro ao processar ediÃ§Ã£o do item"),$scope.atualizaPedido(),$scope.item_edt.quantidade=1})},$scope.alteraQuantEdtItem=function(){_log("alterando quantidade item"),_log("item : "+$scope.id_edicao),_log("quantidade : "+$scope.item_edt.quantidade),$scope.itens_pedido[$scope.id_edicao].quantidade=+$scope.item_edt.quantidade},$scope.finalizaPedido=function(){if($scope.entregar||$scope.retirar)if(!$scope.entregar||void 0!==$scope.dados_entrega.tipo&&""!=$scope.dados_entrega.tipo)if($scope.entregar?$scope.dados_entrega.metodo="entregar":$scope.dados_entrega.metodo="retirar",""!=$scope.itens_pedido){$scope.finalizando=!0,$(".overlay").show(1);var valBtn=$("#botaoFinaliza").html();$("#botaoFinaliza").html('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>'),$http({method:"POST",url:BASE_URL+"pedidos/gera_pedido",data:{entrega:$scope.dados_entrega},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.finalizando=!1,$(".overlay").hide(),$("#botaoFinaliza").html(valBtn),"erro"!=data?(toastr.success("Pedido gerado com suceeso"),$scope.mensagemSucessoPedido=!0,$scope.atualizaPedido(),$(".modal").modal("hide")):toastr.error("Erro crÃ­tico ao gerar pedido COD:#500")}).error(function(){toastr.error("Erro ao gerar pedido")})}else toastr.warning("Adicione ao menos um item ao pedido");else toastr.warning("Selecione a forma de pagamento");else toastr.warning("Selecione a forma de entrega")},$scope.trocoPara=function(tipo){""!=$scope.dados_entrega.troco_para&&null!=$scope.dados_entrega.troco_para&&void 0!==$scope.dados_entrega.troco_para||($scope.dados_entrega.troco_para=parseInt($scope.total_pedido)),$scope.trocopara="dinheiro"==tipo},$scope.entrega=function(tipo){console.log($scope.meus_dados),_log("alterando entrega : "+tipo),"entregar"==tipo?($scope.entregar=!0,$scope.retirar=!1,""==$scope.meus_dados.valor_entrega||null==$scope.meus_dados.valor_entrega?($scope.dados_entrega.valor_entrega=0,$scope.dados_entrega.troco_para=parseInt(parseInt($scope.total_pedido)+1)):($scope.dados_entrega.valor_entrega=parseFloat($scope.meus_dados.valor_entrega),$scope.dados_entrega.troco_para=parseInt(parseInt($scope.total_pedido)+1+parseInt($scope.meus_dados.valor_entrega)))):"retirar"==tipo?($scope.entregar=!1,$scope.retirar=!0,$scope.dados_entrega.valor_entrega="",$scope.dados_entrega.troco_para=parseInt($scope.total_pedido+.5)):($scope.entregar=!1,$scope.retirar=!1,$scope.dados_entrega={})},$scope.inicializa(),$scope.atualizaPedido()});var confPizza=function(){return!0},carregandoPedido=function(carregando){void 0===carregando&&(carregando=!0),carregando?(_log("carregando pedido"),$("#divPedido").after('<div class="loadingPedidoBox"><hr><h1><center>Carregando pedido <img src="'+BASE_URL+'images/loading.gif"></center></h1></div>')):(_log("pedido carregado"),$(".loadingPedidoBox").remove())};angular.module("compraPizzas").controller("pedidosCtrl",function($scope,$http,$location,sharedMessages){"use strict";inner("bar"),$scope.lista_pedidos={},$scope.id_pedido_detalhe=0,selecionaMenu("pedidos"),$http.get(BASE_URL+"pedidos/get_pedidos").success(function($data){$scope.lista_pedidos=$data,$scope.lista_pedidos.length>0&&'""'!=$scope.lista_pedidos?$scope.has_pedidos=!0:($scope.lista_pedidos={},$scope.has_pedidos=!1)}),$scope.carregaDetalhesPedido=function(id_ped){_log("Carregando detalhes do pedido : "+id_ped),$scope.id_pedido_detalhe=id_ped,$("#modalDetalhes").modal(),$scope.detalhes={},$http({method:"GET",url:BASE_URL+"pedidos/get_pedidos_detalhes/"+id_ped,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){for(i=0;i<data.pizzas.length;i++)data.pizzas[i].sabores=JSON.parse(data.pizzas[i].sabores);for(var i=0;i<data.calzones.length;i++)data.calzones[i].sabores=JSON.parse(data.calzones[i].sabores);$scope.detalhes=data,$scope.detalhes.id=id_ped}).error(function(){$scope.detalhes={},$scope.detalhes.id=""})}}),angular.module("compraPizzas").controller("dadosCtrl",function($scope,$location,$http,$location,$route,sharedMessages){inner("bar"),_log("Exibindo dados do usuario"),selecionaMenu("dados"),$(".modal-backdrop").hide(),$('.nav-tabs a[href="#dados_gerais"]').trigger("click"),$http.get(BASE_URL+"pedidos/get_cadastro").success(function($data){$scope.meus_dados=$data}),$http.get(BASE_URL+"ajax/get_cidades").success(function($data){$scope.cidades=$data}),$scope.gravaDadosGerais=function(){_log("Gravando dados gerais...."),$scope.isDisabled=!0,$http({method:"POST",url:BASE_URL+"ajax/grava_dados_cadastro",data:{dados:$scope.meus_dados},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.isDisabled=!1,"erro"!=data?toastr.success("Dados gravados com sucesso"):toastr.error("Erro crÃ­tico ao gerar pedido COD:#500")}).error(function(){$scope.isDisabled=!1,toastr.error("Erro ao gerar pedido")})},$scope.gravaDadosSeguranca=function(){_log("Gravando dados de seguranca...."),$scope.isDisabled=!0,$http({method:"POST",url:BASE_URL+"ajax/grava_dados_seguranca",data:{dados:$scope.sec_dados},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){$scope.isDisabled=!1,"senha_incorreta"==data?(toastr.error("Senha incorreta"),$scope.sec_dados.senha=""):"minimo_caracteres"==data?(toastr.error("A nova senha deve conter no mÃ­nimo 6 caracteres"),$scope.sec_dados.nova_senha="",$scope.sec_dados.nova_senha_confirma=""):"senhas_nao_coincidem"==data?(toastr.error("Senhas nÃ£o coincidem"),$scope.sec_dados.nova_senha="",$scope.sec_dados.nova_senha_confirma=""):($scope.sec_dados={},$location.path("/"),toastr.success("Senha alterada com sucesso"))}).error(function(){$scope.isDisabled=!1,toastr.error("Erro ao gerar pedido")})}}),function(window){"use strict";function applyValidator(validator,validatorName,ctrl){ctrl.$validators?ctrl.$validators[validatorName]=function(modelValue,viewValue){var value=modelValue||viewValue;return validator.isValid(value)||!value}:ctrl.$parsers.unshift(function(viewValue){var value=viewValue.replace(/\D/g,""),valid=validator.isValid(value)||!value;return ctrl.$setValidity(validatorName,valid),valid?viewValue:void 0})}var module=angular.module("ngCpfCnpj",[]);window.CPF&&module.directive("ngCpf",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){applyValidator(CPF,"cpf",ctrl)}}}),window.CNPJ&&module.directive("ngCnpj",function(){return{restrict:"A",require:"ngModel",link:function(scope,elm,attrs,ctrl){applyValidator(CNPJ,"cnpj",ctrl)}}})}(this);